<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && user" class="profile-content">
    <!-- Header -->
    <div class="profile-header">
      <button class="btn btn-outline-secondary back-btn" (click)="goBack()">
        <i class="fas fa-arrow-left"></i> Back to Home
      </button>
      <h2 class="profile-title">My Profile</h2>
    </div>

    <!-- Profile Image Section -->
    <div class="profile-image-section">
      <div class="profile-image-container" (click)="onProfileImageClick()">
        <img 
          [src]="profileImageUrl || getDefaultProfileImage()" 
          [alt]="user.name + ' profile picture'"
          class="profile-image"
          [class.uploading]="isUploadingImage"
        >
        <div class="image-overlay">
          <i class="fas fa-camera"></i>
          <span>{{ isUploadingImage ? 'Uploading...' : 'Change Photo' }}</span>
        </div>
        <div *ngIf="isUploadingImage" class="upload-spinner">
          <div class="spinner-border spinner-border-sm text-white" role="status"></div>
        </div>
      </div>
      <div *ngIf="uploadError" class="alert alert-danger mt-2">
        {{ uploadError }}
      </div>
    </div>

    <!-- User Information -->
    <div class="user-info-section">
      <div class="info-card">
        <h3 class="user-name">{{ user.name }}</h3>
        <p class="user-email">{{ user.email }}</p>
        <div class="user-details">
          <div class="detail-item">
            <strong>Role:</strong> 
            <span class="badge" [class]="'badge-' + user.role.toLowerCase()">
              {{ user.role }}
            </span>
          </div>
          <!-- Replacing single committee display with multiple committees -->
          <div class="detail-item" *ngIf="userCommittees.length > 0">
            <strong>Committees:</strong> 
            <div class="committees-list">
              <div *ngFor="let committee of userCommittees" class="committee-item">
                <span class="committee-name">{{ committee.committee_name }}</span>
                <span class="committee-role badge badge-info">{{ committee.member_role }}</span>
                <small class="committee-head">Head: {{ committee.head_name }}</small>
              </div>
            </div>
          </div>
          <div class="detail-item" *ngIf="userCommittees.length === 0">
            <strong>Committees:</strong> 
            <span class="text-muted">Not a member of any committee</span>
          </div>
          <div class="detail-item" *ngIf="user.created_at">
            <strong>Member since:</strong> 
            <span>{{ formatDate(user.created_at) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- User Posts Section -->
    <div class="user-posts-section">
      <h4 class="posts-title">My Posts ({{ userPosts.length }})</h4>
      
      <!-- No Posts Message -->
      <div *ngIf="userPosts.length === 0" class="no-posts">
        <i class="fas fa-images fa-3x text-muted mb-3"></i>
        <h5>No posts yet</h5>
        <p class="text-muted">Start sharing your thoughts and experiences!</p>
      </div>

      <!-- Posts Grid -->
      <div *ngIf="userPosts.length > 0" class="posts-grid">
        <div *ngFor="let post of userPosts" class="post-card">
          <div class="post-media" *ngIf="post.cloudinary_url" (click)="openPost(post)" style="cursor: pointer;">
            <img [src]="post.cloudinary_url" [alt]="post.description_user || post.description_ai" class="post-image">
          </div>
          <div class="post-content">
            <!-- Updated to use description fields from Post interface -->
            <h6 class="post-title">{{ post.description_user || 'Post by ' + user.name }}</h6>
            <p class="post-text">{{ post.description_ai }}</p>
            <div class="post-actions">
              <button 
                class="btn btn-sm action-btn"
                (click)="toggleLike(post)"
              >
                <i class="fas fa-heart"></i>
                {{ post.likes.length }}
              </button>
              <span class="action-btn">
                <i class="fas fa-comment"></i>
                {{ post.comments.length }}
              </span>
            </div>
            <small class="post-date text-muted">
              {{ formatDate(post.created_at.toString()) }}
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !user" class="error-container">
    <div class="alert alert-danger">
      <h5>Unable to load profile</h5>
      <p>Please try logging in again.</p>
      <button class="btn btn-primary" (click)="goBack()">Go to Home</button>
    </div>
  </div>
</div>
